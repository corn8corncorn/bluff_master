spring:
  application:
    name: bluff-master-backend

  datasource:
    # url: jdbc:mysql://localhost:3306/bluff_master?useSSL=false&serverTimezone=Asia/Taipei&characterEncoding=UTF-8
    url: jdbc:mysql://localhost:3306/bluff_master?useSSL=false&serverTimezone=Asia/Taipei&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0

  servlet:
    multipart:
      max-file-size: 100MB # 單個文件最大大小（允許上傳大圖片，後續會自動壓縮）
      max-request-size: 500MB # 整個請求最大大小（支持多文件上傳）

server:
  port: 8080
  servlet:
    context-path: /api
    session:
      cookie:
        name: JSESSIONID
        http-only: true
        secure: false # 開發環境設為 false，生產環境應設為 true（HTTPS）
        same-site: lax # 允許跨站請求攜帶 cookie
        path: /api # 設置 cookie 路徑，確保只在 /api 路徑下有效
      timeout: 30m # Session 過期時間：30 分鐘
      tracking-modes: cookie # 明確使用 cookie 來追蹤 session
  tomcat:
    max-swallow-size: 100MB # Tomcat 連接器允許的最大請求體大小

# Storage Configuration
storage:
  type: ${STORAGE_TYPE:local} # local 或 gcp
  upload-dir: ${STORAGE_UPLOAD_DIR:./uploads} # 圖片上傳目錄（僅 local 模式使用）

# GCP Storage Configuration (僅在 storage.type=gcp 時需要)
gcp:
  storage:
    bucket-name: ${GCP_BUCKET_NAME:bluff-master-images}
    project-id: ${GCP_PROJECT_ID:}
    credentials-path: ${GCP_CREDENTIALS_PATH:}

# Game Configuration
game:
  max-players: 10
  min-players: 4
  max-image-size: 5242880 # 5MB in bytes
  image-compression:
    min-width: 720
    max-width: 1080
  voting-timeout: 10 # seconds
  room-timeout: 10800 # 3 hours in seconds
  fake-image-url: ${FAKE_IMAGE_URL:https://picsum.photos/800/600}

logging:
  level:
    com.bluffmaster: DEBUG
    org.springframework.web: INFO
